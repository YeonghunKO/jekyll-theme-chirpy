<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="playField,finsishBanner 리팩토링" /><meta property="og:locale" content="en" /><meta name="description" content="1. 함수하나당 하나의 기능만 수행" /><meta property="og:description" content="1. 함수하나당 하나의 기능만 수행" /><link rel="canonical" href="https://yeonghunko.github.io/posts/carrot4/" /><meta property="og:url" content="https://yeonghunko.github.io/posts/carrot4/" /><meta property="og:site_name" content="노력도 재능이다." /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-02-24T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="playField,finsishBanner 리팩토링" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"1. 함수하나당 하나의 기능만 수행","url":"https://yeonghunko.github.io/posts/carrot4/","@type":"BlogPosting","headline":"playField,finsishBanner 리팩토링","dateModified":"2021-02-24T00:00:00+09:00","datePublished":"2021-02-24T00:00:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://yeonghunko.github.io/posts/carrot4/"},"@context":"https://schema.org"}</script><title>playField,finsishBanner 리팩토링 | 노력도 재능이다.</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="노력도 재능이다."><meta name="application-name" content="노력도 재능이다."><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/tourist.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">노력도 재능이다.</a></div><div class="site-subtitle font-italic">모든것을 흡수하려는 마음가짐</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/YeonghunKO" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['yhko1988','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>playField,finsishBanner 리팩토링</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>playField,finsishBanner 리팩토링</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> YeonghunKO </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Feb 24, 2021, 12:00 AM +0900" >Feb 24<i class="unloaded">2021-02-24T00:00:00+09:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1492 words">8 min read</span></div></div><div class="post-content"><h1 id="1-함수하나당-하나의-기능만-수행">1. 함수하나당 하나의 기능만 수행</h1><p>지금 기존의 함수를 보면은 displayAll에서 carrotcount가 들어가 있고 startGame 함수에서도 게임을 시작하는것 뿐만 아니라 일시중지, 다시시작하는 기능까지 들어있다.</p><p>또한 data.json을 이용해서 다량의 아이콘을 만들었는데 그럴필요없이 for문을 사용하면 된다. 참!! 본격적으로 리팩토링을 시작하기 전에 기존의 함수를 다듬어야 한다. 바로 1함수1기능으로 다 만들고, 비효율적인 코드는 수정한다음 리팩토링을 진행해야한다는 뜻이다.</p><h1 id="2-리팩토링">2. 리팩토링</h1><h2 id="2-1-popup">2-1. popup</h2><p>먼저 popup부터 리팩토링해보도록 하겠다. 우선 main.js에서 popup에 관련된 함수만을 다 빼와서 finishBanner.js에 모아두자. 그리고 class안에 보관!</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span text-data=" JavaScript "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">Banner</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">finishBanner</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">.popup</span><span class="dl">"</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">gameResult</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">finishBanner</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">span</span><span class="dl">"</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">replayBtn</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">.replay</span><span class="dl">"</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">nextStageBtn</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">.next_stage</span><span class="dl">"</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">replayBtn</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">OnReplayClick</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">OnReplayClick</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">setOnReplayClick</span><span class="p">(</span><span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">OnReplayClick</span> <span class="o">=</span> <span class="nx">func</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">hide</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">finishBanner</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">non_display</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">show</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">finishBanner</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="dl">"</span><span class="s2">non_display</span><span class="dl">"</span><span class="p">);</span>
    <span class="kd">let</span> <span class="nx">message</span><span class="p">;</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="dl">"</span><span class="s2">win</span><span class="dl">"</span><span class="p">:</span>
        <span class="nx">message</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">you won!  replay?🎉</span><span class="dl">"</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="dl">"</span><span class="s2">bug</span><span class="dl">"</span><span class="p">:</span>
        <span class="nx">message</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">You clicked the bug😝 wanna play again?</span><span class="dl">"</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="dl">"</span><span class="s2">timeout</span><span class="dl">"</span><span class="p">:</span>
        <span class="nx">message</span> <span class="o">=</span> <span class="s2">`Time out..😅 Wanna play again?`</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="dl">"</span><span class="s2">restart</span><span class="dl">"</span><span class="p">:</span>
        <span class="nx">message</span> <span class="o">=</span> <span class="s2">`Restart?`</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="dl">"</span><span class="s2">finally</span><span class="dl">"</span><span class="p">:</span>
        <span class="nx">message</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Completed all stages🎉 going back to stage 1?</span><span class="dl">"</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="nl">default</span><span class="p">:</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">"</span><span class="s2">unvalid mesage</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">gameResult</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">message</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>우선 constructor함수는 class Banner가 만들어지면 자동으로 실행된다. 그리고 그 외에 함수는 invoke할때만 실행된다.</p><p>리플레이버튼을 클릭했을때 게임이 실행되려면 startGame 함수가 필요한데 finishBanner안에는 popup관련 함수만 있어야 하므로 startGame은 game module에서 넘겨받기로 했다. 그래서 setOnReplayClick을 이용해서 startGame함수를 넘겨받고 OnReplayClick에 저장한다음 있으면(&amp;&amp;) 그걸 실행하도록 했다.</p><p>또한 네이밍도 showBanner가 아닌 show여야 한다. 왜냐하면, 예를 들어 showBanner라고 이름을 지었다고 해보자. 나중에 클래스 안에 있는 showbanner메소드를 호출할때 banner.showBanner 라고하면 중복이 발생하기 때문. banner.show라고 이름짓는게 훨씬 깔끔.</p><h2 id="2-2-play_field">2-2. play_field</h2><p>playField.js</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span text-data=" JavaScript "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
</pre><td class="rouge-code"><pre><span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">sound</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./sound.js</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">CARROT_SIZE</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">Field</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// this.IconCount = IconCount;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">playField</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">.play_field</span><span class="dl">"</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">carrotCount</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">playField</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="dl">"</span><span class="s2">carrot</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">setIconClickEvent</span><span class="p">(</span><span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">onClick</span> <span class="o">=</span> <span class="nx">func</span><span class="p">;</span>
    <span class="c1">// this.onClick &amp;&amp; this.onClick.bind(this);</span>
  <span class="p">}</span>

  <span class="nx">onIconButton</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">whichIcon</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">whichIcon</span><span class="p">.</span><span class="nx">matches</span><span class="p">(</span><span class="dl">"</span><span class="s2">.carrot</span><span class="dl">"</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">whichIcon</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">onClick</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">onClick</span><span class="p">(</span><span class="dl">"</span><span class="s2">carrot</span><span class="dl">"</span><span class="p">);</span>
      <span class="nx">sound</span><span class="p">.</span><span class="nx">playCarrotSound</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">whichIcon</span><span class="p">.</span><span class="nx">matches</span><span class="p">(</span><span class="dl">"</span><span class="s2">.bug</span><span class="dl">"</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">onClick</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">onClick</span><span class="p">(</span><span class="dl">"</span><span class="s2">bug</span><span class="dl">"</span><span class="p">);</span>
      <span class="nx">sound</span><span class="p">.</span><span class="nx">playBugSound</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">_creatIcon</span><span class="p">(</span><span class="nx">iconName</span><span class="p">,</span> <span class="nx">iconPath</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// private 한 함수는 underscore를 붙여줌. typescript에선 private이라고 지정하는 기능이 있는데 바닐라 JS는 아직 없다ㅠ</span>
    <span class="nx">iconName</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">`./img/</span><span class="p">${</span><span class="nx">iconPath</span><span class="p">}</span><span class="s2">.png`</span><span class="p">;</span>
    <span class="nx">iconName</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">iconPath</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">playCoor</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">playField</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">x1</span> <span class="o">=</span> <span class="nx">playCoor</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">y1</span> <span class="o">=</span> <span class="nx">playCoor</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
    <span class="c1">// CARROT_SIZE 를 빼는 이유는?</span>
    <span class="c1">// icon이 출력되는 범위를 화면에 꽉 채우게 될때, 만약 좌표가 화면 끝에 위치하게 된다고 가정해보면, 당근 왼쪽 끝부분이 그 좌표에 맞춰지게 된다.</span>
    <span class="c1">// 따라서 화면 밖으로 벗어나게 됨. 그래서 화면 안에서 출력되게 하려면 애초에 화면의 가로, 세로 길이가 당근의 가로 세로만큼 줄어들어야 당근이 삐져나오지 않게 됨.(논리적이다)</span>
    <span class="kd">var</span> <span class="nx">translateX</span> <span class="o">=</span> <span class="nx">getRandomCoor</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">x1</span> <span class="o">-</span> <span class="nx">CARROT_SIZE</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">translateY</span> <span class="o">=</span> <span class="nx">getRandomCoor</span><span class="p">(</span><span class="nx">y</span><span class="p">,</span> <span class="nx">y1</span> <span class="o">-</span> <span class="nx">CARROT_SIZE</span><span class="p">);</span>

    <span class="nx">iconName</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">transform</span> <span class="o">=</span> <span class="s2">`translate(</span><span class="p">${</span><span class="nx">translateX</span><span class="p">}</span><span class="s2">px,</span><span class="p">${</span><span class="nx">translateY</span><span class="p">}</span><span class="s2">px)`</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">iconName</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">createCarrotIcon</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">imgCarrot</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">carrotIcon</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_creatIcon</span><span class="p">(</span><span class="nx">imgCarrot</span><span class="p">,</span> <span class="dl">"</span><span class="s2">carrot</span><span class="dl">"</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">playField</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">carrotIcon</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">createBugIcon</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">imgBug</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">bugIcon</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_creatIcon</span><span class="p">(</span><span class="nx">imgBug</span><span class="p">,</span> <span class="dl">"</span><span class="s2">bug</span><span class="dl">"</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">playField</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">bugIcon</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">displayAllIcon</span><span class="p">(</span><span class="nx">count</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 콜백으로 넘겨줄때 this 바인딩함! callback function binded with this.</span>
    <span class="c1">// 이거때문에 좀 헤맴 ㅋ 버그있을때는 똑같은 stage에 머무르지말고 알고리즘내에서 버그가 발생했다고 생각하는 지점에서</span>
    <span class="c1">// 차근차근 한단계씩 거슬러올라가보길</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">playField</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onIconButton</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">playField</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">""</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">count</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">createCarrotIcon</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">createBugIcon</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">getRandomCoor</span><span class="p">(</span><span class="nx">min</span><span class="p">,</span> <span class="nx">max</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="nx">max</span> <span class="o">-</span> <span class="nx">min</span><span class="p">)</span> <span class="o">+</span> <span class="nx">min</span><span class="p">;</span>
  <span class="c1">// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/random 참고</span>
<span class="p">}</span>
</pre></table></code></div></div><p>보면 그전에 만든 sound를 import해서 잘 사용하고 있는걸 볼 수 있다.</p><p>또한 아이콘을 클릭하면 나타나는 이벤트를 넘겨 받기 위해서 setIconClickEvent 메소드를 만들었다.</p><p>getRandomCoor는 class바깥에 있다. constructor안에 있는 정보를 사용할 필요가 없는 함수. 완전 독립적으로 존재해도 이상하지 않을 함수라서 빼는게 낫다. 안그럼 class를 불러낼때마다 쓸데없이 저장되서 메모리 손실 발생.</p><p>또한 여기서 눈여겨봐야하는 건 binding이다. displayAllIcon함수를 보면 class안에있는 onIconButton 메소드를 넘겨주는걸 볼 수 있다. 이때 onIconButton안에 있는 this까지 넘겨주는건 아니다. 따라서 this를 메소드와 binding해야한다(묶어줘야한다) binding하는 방법엔 3가지가 있다</p><ol><li>this.onIconButton = this.onIconButton.bind(this)<li>this.playField.addEventListener(“click”,(event) =&gt; this.onIconButton(event));<li>onIconButton = (event) =&gt; {…}</ol><p>참고로 arrow function로 만들면 저번에 배웠던것 처럼 arrow funciton 안에는 this가 없으니, 상위스코프로 넘어가서 this를 찾으려고 할거기 때문에 자동으로 this가 명시되는 결과로 이어진다. 그럼 다음글에서는 top_ui를 리팩토링해보도록 하자</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/javascript/'>Javascript</a>, <a href='/categories/carrot-game/'>carrot-game</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/class/" class="post-tag no-text-decoration" >class</a> <a href="/tags/binding/" class="post-tag no-text-decoration" >binding</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=playField,finsishBanner 리팩토링 - 노력도 재능이다.&url=https://yeonghunko.github.io/posts/carrot4/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=playField,finsishBanner 리팩토링 - 노력도 재능이다.&u=https://yeonghunko.github.io/posts/carrot4/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=playField,finsishBanner 리팩토링 - 노력도 재능이다.&url=https://yeonghunko.github.io/posts/carrot4/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/clone4/">http://donicaida.com</a><li><a href="/posts/clone3/">https://paint-box.com 2</a><li><a href="/posts/clone2/">https://paint-box.com 1</a><li><a href="/posts/clone1/">https://besthorrorscenes.com - html 구조</a><li><a href="/posts/basic1/">flex 하게 소리질러!!</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/blogging/">blogging</a> <a class="post-tag" href="/tags/class/">class</a> <a class="post-tag" href="/tags/debugging/">debugging</a> <a class="post-tag" href="/tags/delegation/">delegation</a> <a class="post-tag" href="/tags/load/">load</a> <a class="post-tag" href="/tags/advanced-calulator/">advanced calulator</a> <a class="post-tag" href="/tags/api/">api</a> <a class="post-tag" href="/tags/article/">article</a> <a class="post-tag" href="/tags/async-await/">async/await</a> <a class="post-tag" href="/tags/beforeunload/">beforeunload</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/jsBasic3/"><div class="card-body"> <span class="timeago small" >Aug 27, 2020<i class="unloaded">2020-08-27T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>클래스다 클래스!</h3><div class="text-muted small"><p> 3. 클래스 클래스는 ES6 부터 제공되는 기능이다. 클래스는 객체가 아니고 객체를 담는 template 라고 생각하면 된다.(근데 typeof 클래스 라고 하면 fucntion이 나온다.) 참고로 클래스의 첫번째 method이름은 반드시 ‘constructor’ 이어야 한다. ‘constructor’를 통해 만들어진 property가 뒤에 사용된다...</p></div></div></a></div><div class="card"> <a href="/posts/carrot5/"><div class="card-body"> <span class="timeago small" >Feb 24<i class="unloaded">2021-02-24T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>시작버튼 리팩토링(gameControl.js)</h3><div class="text-muted small"><p> 1. top_ui 리팩토링 gameControl.js 파일 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 ...</p></div></div></a></div><div class="card"> <a href="/posts/carrot6/"><div class="card-body"> <span class="timeago small" >Feb 24<i class="unloaded">2021-02-24T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>main.js에 게임 선언</h3><div class="text-muted small"><p> 1.main.js에 게임을 선언하기 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 "use strict"; import { Game, FinishReason, StopReason } from "./gam...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/carrot3/" class="btn btn-outline-primary" prompt="Older"><p>export로 sound.js 리팩토링</p></a> <a href="/posts/carrot5/" class="btn btn-outline-primary" prompt="Newer"><p>시작버튼 리팩토링(gameControl.js)</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/username">YeonghunKO</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/blogging/">blogging</a> <a class="post-tag" href="/tags/class/">class</a> <a class="post-tag" href="/tags/debugging/">debugging</a> <a class="post-tag" href="/tags/delegation/">delegation</a> <a class="post-tag" href="/tags/load/">load</a> <a class="post-tag" href="/tags/advanced-calulator/">advanced calulator</a> <a class="post-tag" href="/tags/api/">api</a> <a class="post-tag" href="/tags/article/">article</a> <a class="post-tag" href="/tags/async-await/">async/await</a> <a class="post-tag" href="/tags/beforeunload/">beforeunload</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://YeonghunKO.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
