---
title: "playField,finsishBanner ë¦¬íŒ©í† ë§"
date: 2021-02-24 +0800
categories: [Javascript, carrot-game]
tags: [class, binding]
---

# 1. í•¨ìˆ˜í•˜ë‚˜ë‹¹ í•˜ë‚˜ì˜ ê¸°ëŠ¥ë§Œ ìˆ˜í–‰

ì§€ê¸ˆ ê¸°ì¡´ì˜ í•¨ìˆ˜ë¥¼ ë³´ë©´ì€ displayAllì—ì„œ carrotcountê°€ ë“¤ì–´ê°€ ìˆê³  startGame í•¨ìˆ˜ì—ì„œë„ ê²Œì„ì„ ì‹œì‘í•˜ëŠ”ê²ƒ ë¿ë§Œ ì•„ë‹ˆë¼ ì¼ì‹œì¤‘ì§€, ë‹¤ì‹œì‹œì‘í•˜ëŠ” ê¸°ëŠ¥ê¹Œì§€ ë“¤ì–´ìˆë‹¤.

ë˜í•œ data.jsonì„ ì´ìš©í•´ì„œ ë‹¤ëŸ‰ì˜ ì•„ì´ì½˜ì„ ë§Œë“¤ì—ˆëŠ”ë° ê·¸ëŸ´í•„ìš”ì—†ì´ forë¬¸ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
ì°¸!! ë³¸ê²©ì ìœ¼ë¡œ ë¦¬íŒ©í† ë§ì„ ì‹œì‘í•˜ê¸° ì „ì— ê¸°ì¡´ì˜ í•¨ìˆ˜ë¥¼ ë‹¤ë“¬ì–´ì•¼ í•œë‹¤. ë°”ë¡œ 1í•¨ìˆ˜1ê¸°ëŠ¥ìœ¼ë¡œ ë‹¤ ë§Œë“¤ê³ , ë¹„íš¨ìœ¨ì ì¸ ì½”ë“œëŠ” ìˆ˜ì •í•œë‹¤ìŒ ë¦¬íŒ©í† ë§ì„ ì§„í–‰í•´ì•¼í•œë‹¤ëŠ” ëœ»ì´ë‹¤.

# 2. ë¦¬íŒ©í† ë§

## 2-1. popup

ë¨¼ì € popupë¶€í„° ë¦¬íŒ©í† ë§í•´ë³´ë„ë¡ í•˜ê² ë‹¤. ìš°ì„  main.jsì—ì„œ popupì— ê´€ë ¨ëœ í•¨ìˆ˜ë§Œì„ ë‹¤ ë¹¼ì™€ì„œ finishBanner.jsì— ëª¨ì•„ë‘ì. ê·¸ë¦¬ê³  classì•ˆì— ë³´ê´€!

```javascript
export default class Banner {
  constructor() {
    this.finishBanner = document.querySelector(".popup");
    this.gameResult = this.finishBanner.querySelector("span");
    this.replayBtn = document.querySelector(".replay");
    this.nextStageBtn = document.querySelector(".next_stage");

    this.replayBtn.addEventListener("click", () => {
      this.OnReplayClick && this.OnReplayClick();
      this.hide();
    });
  }

  setOnReplayClick(func) {
    this.OnReplayClick = func;
  }

  hide() {
    this.finishBanner.classList.add("non_display");
  }

  show(result) {
    this.finishBanner.classList.remove("non_display");
    let message;
    switch (result) {
      case "win":
        message = "you won!  replay?ğŸ‰";
        break;
      case "bug":
        message = "You clicked the bugğŸ˜ wanna play again?";
        break;
      case "timeout":
        message = `Time out..ğŸ˜… Wanna play again?`;
        break;
      case "restart":
        message = `Restart?`;
        break;
      case "finally":
        message = "Completed all stagesğŸ‰ going back to stage 1?";
        break;
      default:
        throw new Error("unvalid mesage");
    }
    this.gameResult.innerHTML = message;
  }
}
```

ìš°ì„  constructorí•¨ìˆ˜ëŠ” class Bannerê°€ ë§Œë“¤ì–´ì§€ë©´ ìë™ìœ¼ë¡œ ì‹¤í–‰ëœë‹¤. ê·¸ë¦¬ê³  ê·¸ ì™¸ì— í•¨ìˆ˜ëŠ” invokeí• ë•Œë§Œ ì‹¤í–‰ëœë‹¤.

ë¦¬í”Œë ˆì´ë²„íŠ¼ì„ í´ë¦­í–ˆì„ë•Œ ê²Œì„ì´ ì‹¤í–‰ë˜ë ¤ë©´ startGame í•¨ìˆ˜ê°€ í•„ìš”í•œë° finishBannerì•ˆì—ëŠ” popupê´€ë ¨ í•¨ìˆ˜ë§Œ ìˆì–´ì•¼ í•˜ë¯€ë¡œ startGameì€ game moduleì—ì„œ ë„˜ê²¨ë°›ê¸°ë¡œ í–ˆë‹¤. ê·¸ë˜ì„œ setOnReplayClickì„ ì´ìš©í•´ì„œ startGameí•¨ìˆ˜ë¥¼ ë„˜ê²¨ë°›ê³  OnReplayClickì— ì €ì¥í•œë‹¤ìŒ ìˆìœ¼ë©´(&&) ê·¸ê±¸ ì‹¤í–‰í•˜ë„ë¡ í–ˆë‹¤.

ë˜í•œ ë„¤ì´ë°ë„ showBannerê°€ ì•„ë‹Œ showì—¬ì•¼ í•œë‹¤. ì™œëƒí•˜ë©´, ì˜ˆë¥¼ ë“¤ì–´ showBannerë¼ê³  ì´ë¦„ì„ ì§€ì—ˆë‹¤ê³  í•´ë³´ì. ë‚˜ì¤‘ì— í´ë˜ìŠ¤ ì•ˆì— ìˆëŠ” showbannerë©”ì†Œë“œë¥¼ í˜¸ì¶œí• ë•Œ banner.showBanner ë¼ê³ í•˜ë©´ ì¤‘ë³µì´ ë°œìƒí•˜ê¸° ë•Œë¬¸. banner.showë¼ê³  ì´ë¦„ì§“ëŠ”ê²Œ í›¨ì”¬ ê¹”ë”.

## 2-2. play_field

playField.js

```javascript
import * as sound from "./sound.js";

const CARROT_SIZE = 60;

export default class Field {
  constructor() {
    // this.IconCount = IconCount;
    this.playField = document.querySelector(".play_field");
    this.carrotCount = this.playField.getElementsByClassName("carrot");
  }

  setIconClickEvent(func) {
    this.onClick = func;
    // this.onClick && this.onClick.bind(this);
  }

  onIconButton = (event) => {
    const whichIcon = event.target;
    if (whichIcon.matches(".carrot")) {
      whichIcon.remove();
      this.onClick && this.onClick("carrot");
      sound.playCarrotSound();
    }
    if (whichIcon.matches(".bug")) {
      this.onClick && this.onClick("bug");
      sound.playBugSound();
    }
  };

  _creatIcon(iconName, iconPath) {
    // private í•œ í•¨ìˆ˜ëŠ” underscoreë¥¼ ë¶™ì—¬ì¤Œ. typescriptì—ì„  privateì´ë¼ê³  ì§€ì •í•˜ëŠ” ê¸°ëŠ¥ì´ ìˆëŠ”ë° ë°”ë‹ë¼ JSëŠ” ì•„ì§ ì—†ë‹¤ã… 
    iconName.src = `./img/${iconPath}.png`;
    iconName.classList.add(`${iconPath}`);
    const playCoor = this.playField.getBoundingClientRect();
    const x = 0;
    const y = 0;
    const x1 = playCoor.width;
    const y1 = playCoor.height;
    // CARROT_SIZE ë¥¼ ë¹¼ëŠ” ì´ìœ ëŠ”?
    // iconì´ ì¶œë ¥ë˜ëŠ” ë²”ìœ„ë¥¼ í™”ë©´ì— ê½‰ ì±„ìš°ê²Œ ë ë•Œ, ë§Œì•½ ì¢Œí‘œê°€ í™”ë©´ ëì— ìœ„ì¹˜í•˜ê²Œ ëœë‹¤ê³  ê°€ì •í•´ë³´ë©´, ë‹¹ê·¼ ì™¼ìª½ ëë¶€ë¶„ì´ ê·¸ ì¢Œí‘œì— ë§ì¶°ì§€ê²Œ ëœë‹¤.
    // ë”°ë¼ì„œ í™”ë©´ ë°–ìœ¼ë¡œ ë²—ì–´ë‚˜ê²Œ ë¨. ê·¸ë˜ì„œ í™”ë©´ ì•ˆì—ì„œ ì¶œë ¥ë˜ê²Œ í•˜ë ¤ë©´ ì• ì´ˆì— í™”ë©´ì˜ ê°€ë¡œ, ì„¸ë¡œ ê¸¸ì´ê°€ ë‹¹ê·¼ì˜ ê°€ë¡œ ì„¸ë¡œë§Œí¼ ì¤„ì–´ë“¤ì–´ì•¼ ë‹¹ê·¼ì´ ì‚ì ¸ë‚˜ì˜¤ì§€ ì•Šê²Œ ë¨.(ë…¼ë¦¬ì ì´ë‹¤)
    var translateX = getRandomCoor(x, x1 - CARROT_SIZE);
    var translateY = getRandomCoor(y, y1 - CARROT_SIZE);

    iconName.style.transform = `translate(${translateX}px,${translateY}px)`;
    return iconName;
  }

  createCarrotIcon() {
    const imgCarrot = new Image();
    const carrotIcon = this._creatIcon(imgCarrot, "carrot");
    this.playField.append(carrotIcon);
  }

  createBugIcon() {
    const imgBug = new Image();
    const bugIcon = this._creatIcon(imgBug, "bug");
    this.playField.append(bugIcon);
  }

  displayAllIcon(count) {
    // ì½œë°±ìœ¼ë¡œ ë„˜ê²¨ì¤„ë•Œ this ë°”ì¸ë”©í•¨! callback function binded with this.
    // ì´ê±°ë•Œë¬¸ì— ì¢€ í—¤ë§´ ã…‹ ë²„ê·¸ìˆì„ë•ŒëŠ” ë˜‘ê°™ì€ stageì— ë¨¸ë¬´ë¥´ì§€ë§ê³  ì•Œê³ ë¦¬ì¦˜ë‚´ì—ì„œ ë²„ê·¸ê°€ ë°œìƒí–ˆë‹¤ê³  ìƒê°í•˜ëŠ” ì§€ì ì—ì„œ
    // ì°¨ê·¼ì°¨ê·¼ í•œë‹¨ê³„ì”© ê±°ìŠ¬ëŸ¬ì˜¬ë¼ê°€ë³´ê¸¸
    this.playField.addEventListener("click", this.onIconButton);
    this.playField.innerHTML = "";
    var i = 0;
    for (i = 0; i < count; i++) {
      this.createCarrotIcon();
      this.createBugIcon();
    }
  }
}

function getRandomCoor(min, max) {
  return Math.random() * (max - min) + min;
  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/random ì°¸ê³ 
}
```

ë³´ë©´ ê·¸ì „ì— ë§Œë“  soundë¥¼ importí•´ì„œ ì˜ ì‚¬ìš©í•˜ê³  ìˆëŠ”ê±¸ ë³¼ ìˆ˜ ìˆë‹¤.

ë˜í•œ ì•„ì´ì½˜ì„ í´ë¦­í•˜ë©´ ë‚˜íƒ€ë‚˜ëŠ” ì´ë²¤íŠ¸ë¥¼ ë„˜ê²¨ ë°›ê¸° ìœ„í•´ì„œ setIconClickEvent ë©”ì†Œë“œë¥¼ ë§Œë“¤ì—ˆë‹¤.

getRandomCoorëŠ” classë°”ê¹¥ì— ìˆë‹¤. constructorì•ˆì— ìˆëŠ” ì •ë³´ë¥¼ ì‚¬ìš©í•  í•„ìš”ê°€ ì—†ëŠ” í•¨ìˆ˜. ì™„ì „ ë…ë¦½ì ìœ¼ë¡œ ì¡´ì¬í•´ë„ ì´ìƒí•˜ì§€ ì•Šì„ í•¨ìˆ˜ë¼ì„œ ë¹¼ëŠ”ê²Œ ë‚«ë‹¤. ì•ˆê·¸ëŸ¼ classë¥¼ ë¶ˆëŸ¬ë‚¼ë•Œë§ˆë‹¤ ì“¸ë°ì—†ì´ ì €ì¥ë˜ì„œ ë©”ëª¨ë¦¬ ì†ì‹¤ ë°œìƒ.

ë˜í•œ ì—¬ê¸°ì„œ ëˆˆì—¬ê²¨ë´ì•¼í•˜ëŠ” ê±´ bindingì´ë‹¤. displayAllIconí•¨ìˆ˜ë¥¼ ë³´ë©´ classì•ˆì—ìˆëŠ” onIconButton ë©”ì†Œë“œë¥¼ ë„˜ê²¨ì£¼ëŠ”ê±¸ ë³¼ ìˆ˜ ìˆë‹¤. ì´ë•Œ onIconButtonì•ˆì— ìˆëŠ” thisê¹Œì§€ ë„˜ê²¨ì£¼ëŠ”ê±´ ì•„ë‹ˆë‹¤. ë”°ë¼ì„œ thisë¥¼ ë©”ì†Œë“œì™€ bindingí•´ì•¼í•œë‹¤(ë¬¶ì–´ì¤˜ì•¼í•œë‹¤) bindingí•˜ëŠ” ë°©ë²•ì—” 3ê°€ì§€ê°€ ìˆë‹¤

1. this.onIconButton = this.onIconButton.bind(this)
2. this.playField.addEventListener("click",(event) => this.onIconButton(event));
3. onIconButton = (event) => {...}

ì°¸ê³ ë¡œ arrow functionë¡œ ë§Œë“¤ë©´ ì €ë²ˆì— ë°°ì› ë˜ê²ƒ ì²˜ëŸ¼ arrow funciton ì•ˆì—ëŠ” thisê°€ ì—†ìœ¼ë‹ˆ, ìƒìœ„ìŠ¤ì½”í”„ë¡œ ë„˜ì–´ê°€ì„œ thisë¥¼ ì°¾ìœ¼ë ¤ê³  í• ê±°ê¸° ë•Œë¬¸ì— ìë™ìœ¼ë¡œ thisê°€ ëª…ì‹œë˜ëŠ” ê²°ê³¼ë¡œ ì´ì–´ì§„ë‹¤.
ê·¸ëŸ¼ ë‹¤ìŒê¸€ì—ì„œëŠ” top_uië¥¼ ë¦¬íŒ©í† ë§í•´ë³´ë„ë¡ í•˜ì
